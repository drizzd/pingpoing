<html>
 <head>
  <script type="application/javascript">
var canvas = null;
var target_fps = 30.0;
var cnt = 0;
var prev_time = null;
var fps_start = null;
var ball = { x: 75, y: 75 };
var v = { x: 2, y: 3 };
var A = { m: 2, n: 4 };

function ackermann(m, n) {
	if (m == 0)
		return n+1;
	else if (n == 0)
		return ackermann(m-1, 1);
	else
		return ackermann(m-1, ackermann(m, n-1));
}

function init() {
	var d = new Date();
	prev_time = d.getTime();

	canvas = document.getElementById("canvas");

	if (!canvas.getContext) {
		alert('canvas.getContext failed');
		return;
	}

	update();
}

function pos_add(a, v) {
	a.x += v.x;
	a.y += v.y;

	return a;
}

function update() {
	var d = new Date();
	var time = d.getTime()
	cnt += 1;
	if (1000*Math.floor(time/1000) > prev_time) {
		var t = time - fps_start;
		if (fps_start && t > 0) {
			var fps = 1000*cnt/t;
			console.log("fps: " + fps.toFixed(1), " ", t, cnt);
		}
		cnt = 0;
		fps_start = time;
	}

	// get busy
	ackermann(A.m, A.n);

	draw();
	prev_time = time;
	setTimeout(update, 1000/target_fps);
}

function drawDisc(ctx, r) {
	ctx.ctrokeStyle = 'grey';
	ctx.beginPath();
	ctx.arc(0,0,r,0,Math.PI*2);
	ctx.fill();
}

function drawBall(ctx, r) {
	var radgrad = ctx.createRadialGradient(-3,-2,1,0,0,r);
	radgrad.addColorStop(0, '#e0e0e0');
	radgrad.addColorStop(0.9, '#686868');
	radgrad.addColorStop(1, 'rgba(1,159,98,0)');

	// draw shapes
	ctx.fillStyle = radgrad;
	ctx.fillRect(-r,-r,2*r,2*r);
}

function drawPanel(ctx, w, h)
{
	ctx.strokeStyle = 'black';
	ctx.lineWidth = w;
	ctx.lineCap = 'round';
	ctx.beginPath();
	ctx.moveTo(0,0);
	ctx.lineTo(0,h);
	ctx.stroke()
}

function draw() {
	var ctx = canvas.getContext("2d");
	var r = 10;

	ctx.save();
	ctx.translate(10, 10);
	drawPanel(ctx, 10, 100);
	ctx.restore();
	
	ctx.save();
	ctx.translate(ball.x,ball.y)
	drawBall(ctx, r);
	//drawDisc(ctx, r);
	ctx.restore();
}
  </script>
 </head>
 <body onload="init();">
   <canvas id="canvas" width="500" height="500">fallback content</canvas>
 </body>
</html>
